<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVENTS PAGE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        #vanta-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        
        /* Fixed: Reduced blur slightly and ensured no clipping */
        .glass-card { 
            background: rgba(255, 255, 255, 0.98); 
            border: 1px solid rgba(255, 255, 255, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .feed-container { width: 100%; max-width: 680px; }
        [x-cloak] { display: none !important; }
        
        /* Force dropdown to be on top of everything */
        .dropdown-top { z-index: 9999 !important; }
    </style>
</head>
<body class="bg-[#f3f2ef] min-h-screen" x-data="{ 
    role: 'admin', 
    userName: 'S. Kumar',
    showModal: false,
    isEditing: false,
    editPostId: null,
    newPostText: '',
    newPostImage: '',
    eventDate: '',
    events: [
        { 
            id: 1, 
            author: 'Alumni Member', 
            type: 'alumni', 
            time: '2h', 
            eventDate: '2026-02-15',
            text: 'Just shared a new update regarding the technical symposium!', 
            image: 'https://images.unsplash.com/photo-1511578314322-379afb476865?auto=format&fit=crop&w=1000&q=80', 
            isSaved: false 
        }
    ],

    handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => { this.newPostImage = e.target.result; };
            reader.readAsDataURL(file);
        }
    },

    addPost() {
        if(this.newPostText.trim() === '') return;
        if(this.isEditing) {
            const index = this.events.findIndex(e => e.id === this.editPostId);
            this.events[index].text = this.newPostText;
            this.events[index].eventDate = this.eventDate;
            if(this.newPostImage) this.events[index].image = this.newPostImage;
        } else {
            const post = {
                id: Date.now(),
                author: this.role === 'admin' ? 'College Admin' : this.userName,
                type: this.role,
                time: 'Just now',
                eventDate: this.eventDate,
                text: this.newPostText,
                image: this.newPostImage || null,
                isSaved: false
            };
            this.events.unshift(post);
        }
        this.resetModal();
    },

    editPost(event) {
        this.isEditing = true;
        this.editPostId = event.id;
        this.newPostText = event.text;
        this.eventDate = event.eventDate;
        this.newPostImage = event.image;
        this.showModal = true;
    },

    resetModal() {
        this.newPostText = '';
        this.newPostImage = '';
        this.eventDate = '';
        this.showModal = false;
        this.isEditing = false;
        this.editPostId = null;
        this.$nextTick(() => lucide.createIcons());
    }
}">

    <div id="vanta-bg"></div>

    <nav class="fixed top-0 w-full bg-white border-b border-slate-200 z-[100]">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-8">
                <a href="home.html" class="text-xl font-black text-slate-900 tracking-tighter">
                    ALUMNI<span class="text-blue-600">HUB</span>
                </a>
                <div class="hidden md:flex gap-6">
                    <a href="home.html" class="text-slate-500 font-bold text-sm">HOME</a>
                    <a href="events.html" class="text-blue-600 font-bold text-sm border-b-2 border-blue-600">EVENTS</a>
                    <a href="jobs.html" class="text-slate-500 font-bold text-sm">JOBS</a>
                </div>
            </div>
            <a href="signin.html" class="text-slate-600 font-bold text-sm hover:text-blue-600">JOIN</a>
        </div>
    </nav>

    <main class="pt-24 pb-12 px-4 flex justify-center">
        <div class="feed-container">
            
            <div class="glass-card rounded-xl p-5 mb-6">
                <div class="flex gap-4">
                    <div class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold">AD</div>
                    <button @click="showModal = true; isEditing = false" class="flex-1 text-left px-6 py-3 rounded-full bg-[#f0f2f5] text-slate-400 text-sm hover:bg-[#e4e6e9] transition">
                        Post Your Content Here.....
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <template x-for="event in events" :key="event.id">
                    <div class="glass-card rounded-xl border border-slate-200 relative mb-4">
                        <div class="p-4">
                            <div class="flex justify-between items-start mb-3">
                                <div class="flex gap-3">
                                    <div class="w-10 h-10 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center font-bold" x-text="event.author[0]"></div>
                                    <div>
                                        <h3 class="font-bold text-sm" x-text="event.author"></h3>
                                        <p class="text-[10px] text-slate-400">
                                            <span x-text="event.time"></span> â€¢ 
                                            <span class="text-blue-600" x-show="event.eventDate">Event: <span x-text="event.eventDate"></span></span>
                                        </p>
                                    </div>
                                </div>

                                <div class="relative" x-data="{ open: false }">
                                    <button @click="open = !open" class="p-1.5 hover:bg-slate-100 rounded-full transition">
                                        <i data-lucide="more-horizontal" class="w-5 h-5 text-slate-500"></i>
                                    </button>
                                    
                                    <div x-show="open" @click.away="open = false" x-cloak 
                                         class="absolute right-0 mt-2 w-44 bg-white border border-slate-200 rounded-xl shadow-2xl dropdown-top py-2">
                                        
                                        <button @click="editPost(event); open = false" class="w-full text-left px-4 py-3 text-xs font-bold text-slate-600 hover:bg-blue-50 hover:text-blue-600 flex items-center gap-3 transition">
                                            <i data-lucide="edit-3" class="w-4 h-4"></i> Edit Post
                                        </button>
                                        
                                        <button @click="event.isSaved = !event.isSaved; open = false" class="w-full text-left px-4 py-3 text-xs font-bold text-slate-600 hover:bg-slate-50 flex items-center gap-3 transition">
                                            <i data-lucide="bookmark" class="w-4 h-4" :class="event.isSaved ? 'fill-blue-600 text-blue-600' : ''"></i> 
                                            <span x-text="event.isSaved ? 'Saved' : 'Save Post'"></span>
                                        </button>

                                        <div class="h-[1px] bg-slate-100 my-1 mx-2"></div>

                                        <template x-if="role === 'admin' || event.author === userName">
                                            <button @click="if(confirm('Delete this?')) events = events.filter(e => e.id !== event.id)" class="w-full text-left px-4 py-3 text-xs font-bold text-red-500 hover:bg-red-50 flex items-center gap-3 transition">
                                                <i data-lucide="trash-2" class="w-4 h-4"></i> Delete Post
                                            </button>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <p class="text-sm text-slate-700 leading-relaxed" x-text="event.text"></p>
                        </div>
                        <template x-if="event.image">
                            <div class="border-t border-slate-100">
                                <img :src="event.image" class="w-full h-auto max-h-[450px] object-cover rounded-b-xl">
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    </main>

    <div x-show="showModal" x-cloak class="fixed inset-0 z-[1000] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-md">
        <div @click.away="resetModal()" class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50">
                <h2 class="font-bold text-slate-800" x-text="isEditing ? 'Edit Post' : 'Create Event Post'"></h2>
                <button @click="resetModal()" class="p-1 hover:bg-slate-200 rounded-full transition"><i data-lucide="x" class="w-5 h-5 text-slate-500"></i></button>
            </div>
            <div class="p-5">
                <textarea x-model="newPostText" class="w-full h-40 p-3 outline-none resize-none text-lg border rounded-xl mb-4 focus:border-blue-500 transition" placeholder="What's the update?"></textarea>
                
                <template x-if="newPostImage">
                    <div class="relative mb-4 group">
                        <img :src="newPostImage" class="w-full h-40 object-cover rounded-xl border">
                        <button @click="newPostImage = ''" class="absolute top-2 right-2 bg-red-500 text-white rounded-full p-1.5 shadow-lg"><i data-lucide="trash" class="w-4 h-4"></i></button>
                    </div>
                </template>

                <div class="flex items-center justify-between border-t pt-5">
                    <div class="flex gap-4 items-center">
                        <label class="cursor-pointer p-2 bg-blue-50 text-blue-600 rounded-full hover:bg-blue-100 transition">
                            <i data-lucide="image" class="w-6 h-6"></i>
                            <input type="file" @change="handleImageUpload" class="hidden" accept="image/*">
                        </label>
                        <div class="flex flex-col">
                            <span class="text-[10px] font-bold text-slate-400 uppercase">Event Date</span>
                            <input type="date" x-model="eventDate" class="text-sm border-none outline-none text-blue-600 font-semibold bg-transparent">
                        </div>
                    </div>
                    <button @click="addPost()" class="bg-blue-600 text-white px-8 py-2.5 rounded-full font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition" x-text="isEditing ? 'Save Changes' : 'Post Now'"></button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Init Lucide and Vanta
        window.addEventListener('load', () => {
            lucide.createIcons();
            VANTA.NET({
                el: "#vanta-bg",
                mouseControls: true, touchControls: true,
                color: 0x3b82f6, backgroundColor: 0xf3f2ef,
                points: 10.00, maxDistance: 20.00, spacing: 18.00
            });
        });
    </script>
</body>
</html>